generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Party {
  id              String              @id @default(cuid())
  name            String
  abbreviation    String
  slug            String              @unique
  logoUrl         String?
  color           String
  website         String?
  programUrl      String?
  description     String?
  foundedYear     Int?
  leaderName      String?
  leaderPhotoUrl  String?
  ideology        String?
  coalition       String?
  previousSeats   Int?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  policyStances   PartyPolicyStance[]
  programSections PartyProgram[]
  pollData        PollData[]
  pollVotes       PollVote[]
}

model PollVote {
  id         String   @id @default(cuid())
  partyId    String
  ipAddress  String
  voterToken String
  createdAt  DateTime @default(now())
  party      Party    @relation(fields: [partyId], references: [id], onDelete: Cascade)

  @@unique([ipAddress, voterToken])
  @@index([partyId])
}

model PolicyComparison {
  id         String              @id @default(cuid())
  category   String
  question   String
  orderIndex Int                 @default(0)
  createdAt  DateTime            @default(now())
  stances    PartyPolicyStance[]
}

model PartyPolicyStance {
  id        String           @id @default(cuid())
  partyId   String
  policyId  String
  value     Boolean?
  note      String?
  createdAt DateTime         @default(now())
  party     Party            @relation(fields: [partyId], references: [id], onDelete: Cascade)
  policy    PolicyComparison @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@unique([partyId, policyId])
  @@index([policyId])
  @@index([partyId])
}

model PartyProgram {
  id           String   @id @default(cuid())
  partyId      String
  sectionTitle String
  content      String
  orderIndex   Int      @default(0)
  createdAt    DateTime @default(now())
  party        Party    @relation(fields: [partyId], references: [id], onDelete: Cascade)

  @@index([partyId])
}

model NationalSegment {
  id          String           @id @default(cuid())
  name        String
  slug        String           @unique
  icon        String
  description String?
  orderIndex  Int              @default(0)
  createdAt   DateTime         @default(now())
  needs       NationalNeed[]
  suggestions NeedSuggestion[]
}

model NeedSuggestion {
  id            String           @id @default(cuid())
  segmentId     String
  title         String
  description   String
  authorEmail   String
  status        String           @default("PENDING")
  likesCount    Int              @default(0)
  dislikesCount Int              @default(0)
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  segment       NationalSegment  @relation(fields: [segmentId], references: [id], onDelete: Cascade)
  votes         SuggestionVote[]

  @@index([segmentId])
  @@index([status])
}

model SuggestionVote {
  id           String         @id @default(cuid())
  suggestionId String
  voterToken   String
  value        Int
  createdAt    DateTime       @default(now())
  suggestion   NeedSuggestion @relation(fields: [suggestionId], references: [id], onDelete: Cascade)

  @@unique([suggestionId, voterToken])
  @@index([suggestionId])
}

model NationalNeed {
  id            String          @id @default(cuid())
  segmentId     String
  title         String
  description   String?
  priority      Int             @default(0)
  orderIndex    Int             @default(0)
  createdAt     DateTime        @default(now())
  dislikesCount Int             @default(0)
  likesCount    Int             @default(0)
  segment       NationalSegment @relation(fields: [segmentId], references: [id], onDelete: Cascade)
  votes         NeedVote[]

  @@index([segmentId])
}

model NeedVote {
  id             String       @id @default(cuid())
  nationalNeedId String
  voterToken     String
  value          Int
  createdAt      DateTime     @default(now())
  need           NationalNeed @relation(fields: [nationalNeedId], references: [id], onDelete: Cascade)

  @@unique([nationalNeedId, voterToken])
  @@index([nationalNeedId])
}

model PollData {
  id         String   @id @default(cuid())
  partyId    String
  percentage Float
  pollSource String
  pollDate   DateTime
  sampleSize Int?
  createdAt  DateTime @default(now())
  party      Party    @relation(fields: [partyId], references: [id], onDelete: Cascade)

  @@index([partyId])
  @@index([pollDate])
}
